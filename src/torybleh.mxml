<?xml version="1.0" encoding="utf-8"?>
<mx:Application
    xmlns:mx="http://www.adobe.com/2006/mxml"
    layout="absolute"
    width="600"
    height="400"
    frameRate="100"
    creationComplete="CreationComplete()"
    enterFrame="EnterFrame(event)"
    currentState="MainMenu"
    applicationComplete="registerGlobalKeyHandler()">
    <mx:states>
        <mx:State
            name="Game"
            enterState="enterGame(event)"
            exitState="exitGame(event)">
            <mx:AddChild>
                <mx:Button x="0" y="0" label="Start" id="dummyButton" visible="false"/>
            </mx:AddChild>
            <!--mx:AddChild relativeTo="{myCanvas}" position="lastChild">
                <mx:Label id="Score" x="5" y="5" text="score" fontSize="16" />
            </mx:AddChild-->
        </mx:State>
        <mx:State name="MainMenu">
            <mx:AddChild relativeTo="{myCanvas}" position="lastChild">
                <mx:Button x="232" y="119" label="Start" id="btnStart" click="startGameClicked(event)" width="136" height="52" fontSize="26"/>
            </mx:AddChild>
            
        </mx:State>
    </mx:states>
    
    <mx:Canvas x="0" y="0" width="100%" height="100%" id="myCanvas"/>

    <mx:Script><![CDATA[
        import mx.managers.FocusManager;
        protected var inGame:Boolean = false;

        public function CreationComplete():void
        {
            GameObjectManager.Instance.addCollidingPair(CollisionIdentifiers.PLAYERWEAPON, CollisionIdentifiers.ENEMY);
        }

        public function EnterFrame(event:Event):void
        {
            if (inGame)
            {
                GameObjectManager.Instance.enterFrame();
                myCanvas.graphics.clear();
                myCanvas.graphics.beginBitmapFill(GameObjectManager.Instance.backBuffer, null, false, false);
                myCanvas.graphics.drawRect(0, 0, this.width, this.height);
                myCanvas.graphics.endFill();
            }
        }

        protected function startGameClicked(event:Event):void
        {
            currentState = "Game"
        }
        
        protected function enterGame(event:Event):void
        {
            GameObjectManager.Instance.startup();
            inGame = true;
            focusManager.setFocus(dummyButton);
        }
        
        protected function exitGame(event:Event):void
        {
            GameObjectManager.Instance.shutdown();
            inGame = false;
        }
        
        protected function keyDown(event:KeyboardEvent):void {
        	GameObjectManager.Instance.keyDown(event);
        }
        
        protected function keyUp(event:KeyboardEvent):void {
        	GameObjectManager.Instance.keyUp(event);
        }
        
        public function registerGlobalKeyHandler() :void
        {
            stage.addEventListener(KeyboardEvent.KEY_DOWN, keyDown);
            stage.addEventListener(KeyboardEvent.KEY_UP, keyUp);
        }
        ]]>
    </mx:Script>
</mx:Application>

